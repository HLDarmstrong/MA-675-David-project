---
title: "Oral and Facial Study"
author: "Tianjian Xie, Amstrong Wang, Haochen Pan, Nuo Chen, Haochen Zhu"
date: "2022-10-28"
output: html_document
---


```{r setup, include=FALSE,echo=FALSE}
knitr::opts_chunk$set(echo = F,message = F,warning = F)
```

```{r}
library(markdown)
library(rmarkdown)
library(knitr)
library(readxl)
library(ggplot2)
library(arsenal)
library(tinytex)
library(tidyr)
library(viridis)
library(viridisLite)
library(nortest)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(scales)
library(arm)
library(car)
```

\newpage

## Introduction

Our client is David Cartier from Boston University Henry M. Goldman School of Dental Medicine. The client’s goal is to analyze the different types of facial fractures from Maine Portland medical center and compare injuries between rural and urban populations.The client asked us to compare two different injury assessment scores between rural and urban populations.These scores are the injury severity score (ISS ) and Glasgow coma scale (GCS). The client also asked us to assess the relationship between injury mechanisms and these two scores, as well as explore factors affecting the frequency of hospital admissions.

## Data Description

The data consists of de-identified medical records for 318 patients from Maine Medical Center. Patients are classified as coming from rural areas or urban areas based on their Zip code and 2010 census data.

The Glasgow Coma Scale (GCS) is used to objectively describe the extent of impaired consciousness in all types of acute medical and trauma patients. The scale assesses patients according to three aspects of responsiveness:eye-opening, motor, and verbal responses. This scale is from 1 to 15 which 13-15 being Mild, 9-12 being Moderate, and 3-8 being Severe.

All injuries are assigned from an internationally recognized dictionary that describes over 2000 injuries. Multiple injuries are scored by adding together the squares of the three highest AIS scores. The ISS is the Injury severity score, which can range from 1 to 75, but we only have from 1 to 50. Also, there are many missing number in the data set, but the important variables do not have missing data.

```{r,results='hide'}
df <- read_xlsx("1717262_Data_5.10.2021_deidentified.xlsx", col_names = T,3)
names(df)[8]<-paste("InjuryType")
names(df)[9]<-paste("UB")
names(df)[13]<-paste("GCS")
df <- df %>% mutate(HospitalDays=df$`Total Hospital Days`) %>% 
  drop_na(GCS) %>% 
  drop_na(ISS) %>% 
  drop_na(HospitalDays)
head(df)
```

```{r, echo=FALSE, message= FALSE, warning= FALSE}
library(naniar)
gg_miss_upset(airquality)
ggplot(df,
       aes(x = ISS,
           y = GCS)) +
 geom_miss_point()+
  facet_wrap(~UB)
```


```{r,fig.cap="Relationship between ISS and GCS"}
ggplot(df,aes(ISS,GCS))+
  geom_point()+
  geom_smooth()
```

```{r}
ggplot(df,aes(ISS,HospitalDays))+
  geom_point()+
  geom_smooth()
```


```{r, fig.show="hold", out.width="50%"}
ggplot(df,aes(x=UB,y=GCS,fill=UB))+
  geom_violin(trim=F)+
  geom_boxplot(width=0.1, fill="white")+
  scale_fill_viridis(discrete = TRUE, alpha=1) +   
  geom_jitter(aes(color=UB))+
  labs(title="Plot of GCS betweem Rural and Urban", y = "GCS")+
  geom_hline(yintercept=c(0,15),color="black")

ggplot(df,aes(x=UB,y=ISS,fill=UB))+
  geom_violin(trim=F)+
  geom_boxplot(width=0.1, fill="white")+
  scale_fill_viridis(discrete = TRUE, alpha=1) +   
  geom_jitter(aes(color=UB))+
  labs(title="Plot of ISS betweem Rural and Urban", y = "ISS")+
  geom_hline(yintercept=c(0,50),color="black")
```

```{r}
ggplot(df,aes(InjuryType,fill=UB))+
  geom_bar(aes(y=(..count..)/sum(..count..)),position = "dodge")+
  scale_y_continuous(labels=percent)+
  ylab("percentage")
```




```{r, fig.show="hold", out.width="50%"}
ggplot(df,aes(`Injury Mech`,ISS))+
  geom_point()+
  coord_flip()+
  ggtitle("ISS with Injury Mech")

ggplot(df,aes(`Injury Mech`,GCS))+
  geom_point()+
  coord_flip()+
  ggtitle("GCS with Injury Mech")
```
## Method

```{r}
#difference in general
t.test(df$ISS,df$GCS)
```

```{r}
#check the normality
shapiro.test(df$ISS)
shapiro.test(df$GCS)
```
The Shapiro-Wilk test is a way to tell if a random sample comes from a normal distribution. From the result from the table shows both ISS and GCS are normally distributed at a level at 0.05. 

```{r}
#Kolmogorov-Smirnov Tests
ks.test(df$ISS[df$UB=="Urban"],df$ISS[df$UB=="Rural"])
ks.test(df$GCS[df$UB=="Urban"],df$GCS[df$UB=="Rural"])
```

The Kolmogorov-Smirnov (K-S) Test is one method to be used for determining if the underlying distribution of the Rural GCS vs Urban GCS, and Rural ICS vs Urban ICS are in fact different. As the above table shows, both P-values from KS-test are greater than 0.05 that we do not have sufficient evidence to fail to reject that the distributions are same distribution. This means there is no significant difference in GCS and ISS between Rural and Urban.

## Fit In Model
Model 1
```{r}
model1 <- lm(log(as.numeric(HospitalDays))~ISS+GCS+UB,df)
summary(model1)
```

```{r}
coefplot(model1)
```

```{r, echo=FALSE, message= FALSE, warning= FALSE}
library(car)
vif(model1)
```

Model 2
```{r}
na_rows <- c(which(is.na(df$Age)))
Age_Cleaned_df <- df[-na_rows,]
model2 <- lm(Age~ISS+GCS+UB,Age_Cleaned_df)
summary(model2)
```

```{r}
coefplot(model2)
```

```{r, echo=FALSE, message= FALSE, warning= FALSE}
vif(model2)
```

Model 3
```{r}
model3 <- lm(ISS~Gender+Race+UB,df)
summary(model3)
```

```{r}
coefplot(model3)
```

```{r, echo=FALSE, message= FALSE, warning= FALSE}
vif(model3)
```


## Check the Model
Model 1
```{r, fig.show="hold", out.width="50%"}
plot(model1,c(1,2))
```

By summary of the model1, we notice that the p-value of the coefficient is smaller than 0.05, which means that there does exist statistical significance of that `ISS` and `GCS` impacts the `HospitalDays`(based on the result of logarithm), However, seeing that the r-squared statistics, our model can only explain % of the data. Therefore, the linear model doesn't fit well.

Model 2
```{r, fig.show="hold", out.width="50%"}
plot(model2,c(1,2))
```

By summary of the model2, we can see that differ from model1, `ISS` and `GCS` now impact the `Age` of the patients more.

Model 3
```{r, fig.show="hold", out.width="50%"}
plot(model3,c(1,2))
```

By summary of the model3, when we are trying to find the influence of `Gender`, `Race`, and `UB`(which is the living area of the patients) on the `ISS`, we can see since the p-value of the `UB` is smaller than 0.05, only `UB` do not have significance influence on the `ISS` of the patients.


## Discussion

Our analysis of patients come from US 2010 census data shows that there is a negative and interactive relationship between ISS value and GCS value, and is related to urban/rural areas. ISS and GCS are normally distributed at a level at 0.05. In our analysis, urban or rural patients may have similar ISS and be more clustered
towards the mean. However, the relationship between GCS and urban/rural cannot be directly explained through linear relationship since we have evidence that ISS and GCS are not normally distributed. In the comparison of other variables, we also believe that factors such as hospitalization time and cause of injury have no way to directly affect the GCS value in different urban/rural situations.


## Conclusion 

Our linear model suggests that there isn’t evidence that there is a relationship between GCS and whether a patients from a rural or Urban origin. In our analysis, urban or rural patients may have similar ISS and be more clustered towards the mean. However, the linear model suggests that the is not much evidence of a relationship between GCS and whether a patient’s origin is urban or rural. Although the EDA suggests that there may be some relationship between these scores and whether a patient is from a rural or urban origin, our models suggest that there is not enough evidence to conclude that there is such a relationship. Additionally, patients with higher GCS and lower ISS could be more likely to stay shortly in the hospital. But our linear model still exists a limitation to give a precise and definite prediction.


## Contribution

Tianjian Xie: Data cleaning, part of EDA(violin plot and box plot of ISS and GCS, scatter plot of ISS against Total Hospital Days and ISS vs GCS, barplot of Injury Types, models fitting), T test and KS test, writing report.
Haocheng Zhu: Data cleaning, combining the EDAs for writing slides and report, presentation
Nuo Chen: Data cleaning, part of EDA(Visualization of ISS against AGE and ISS vs GCS, analysis of Injury Types, models fitting), Presentation for client
Haochen Pan: Data cleaning, part of EDA(Scatter plot of ISS against Total Hospital Days and ISS vs GCS, models analysis for linear model), writing the slides and report
Shengbo Wang: Data cleaning, part of EDA(Analysis for injury type, models fitting),KS test analysis, Model analysis for problems of linear model, presentation and writing report

